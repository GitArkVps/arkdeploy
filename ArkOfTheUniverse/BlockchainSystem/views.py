from django.contrib.auth import authenticate, login, logout
from django.shortcuts import render, redirect
from django.http import HttpResponse, JsonResponse
from django.contrib.auth import authenticate, login
from django.contrib.auth.models import User
from django.views.decorators.csrf import csrf_exempt

from GeneralSystem.models import Player
from BlockchainSystem.models import MoralisAPI, MoralisAuth
from datetime import datetime
import requests, json, time

AllowedAddress = ["0xa86720f2d7728124e3b5aa2235e0d2bb2c9944e6","0xd73f31f9da8a9e71f03fab4bff52c839feb44f39","0x8a192755c1eafdb41f0c46f4f9afb2ce30dd3c27","0x0d8ed500c87fb1c78eb5a767a93777a2a47abf2f","0x6f1bd2aff4c03e74534ee24232715bbb9b6f858c","0xf0ab1915a090ba37fd86c849ac87b3a2601a409e","0xdca86799a47f90ddf069ec6e7a974e513b3d6804","0x83e35b05b45277d76ec7e09d6c9632d38ce6b973","0xed2afbc2be6e7be742d17741b846f4c07b77fa57","0x1604a5a120811a288c88682a9b2731b11a4619fa","0x1ea7a9d26b8b7ca95b3ef0b4d0fabf6ba17ac2d7","0x812b3e94161d66db72865286c0a74b3efb51bea6","0xb0cf74d13169f219e475e2dee4e6f6e1d55df70d","0xd52ba66b6c434bd8a0a07526d937d2e97fa7c6ee","0xa085bffd1233d842f6ef8c9bba70ba84ce344ac7","0x2244cc475b1bd5f9dc71cde919fa67cae6f0160a","0x15711104a269010b5ed2ddb1fd6685ad79c8f3f0","0xe5364a9618d511498f8904359c2b06045914a706","0x5fe4c0dbaf31c8674c0232ca59c4cef6554a2c68","0xdeeeb7ade81c809c6a1ed903c44713cd03d2681d","0x0d669a8b1591f2b22fe53fdab26d38005e34c11a","0x5953eb1424b48fffcf514171e5adb6324920f000","0xc3072cc748bbacb9d5121db7129b4b0b5ecc431d","0x0de1f531b87800b67bc372390a53c737ea0eca52","0x4edce8dcb8e60aa9dccdc929098db5ca0966e427","0x3d794034b31c9807d935e527d794b1b60d1a7312","0x657842fa343de16ac6b00efd0ae188da13efbdb1","0xe6b35f9e19301adf6513229f4f849024b6df72ab","0x4c345ff7465f5a069eba80532f4ead56213d8d75","0x0ca7023b600fb677a551d7521f33034eff738c3b","0xab9a2736603e47a6b70ee3e42908c7e5b38faa3d","0xb77db796b5c2cc192f673814bbc377a1ec55e775","0x5d7e47b46857894937a3be5607f06712bb0f2019","0x2ce96d4a00e9e72590ff9ceb4aec6c5e409f4025","0x594a2b450c081dc7437086417b27ae3869bb809e","0xb9c8e9acf0fbaf57ee023e00a7d915c22858050e","0xc341e72054cc19c559d47f8882472150c636eab8","0x523ff61963231aecdb7b513fbf849522c4d5e429","0x8ff4146492daf3bc8c4dbd69ed0a91413babaf33","0x4671d80e5779009c26b0e4defdbf354a216d72bd","0xe281f546866b50492a86c7db42654abed1369101","0x0dcbc3a0b0a8a1bc455c99b2105574656ed41fe6","0x28ffa4a9fe6d9f788323797c4c72af5227f77ebb","0xfccd83cf0029c994471b301597502bd578fc0870","0x3f288a7d0867c8c67e3690c78c9f720b07b7628e","0x062aaf849bd12c7b231582dc41196d8b04443131","0x164da54e7b885b81a71f35af0c33b11069e31314","0x0de70a62bc817fc0ccc2d006c283772eccd4f778","0xff65efea1cd5c15c05643b1656d1834fdf4f4687","0x9f542426f4f56d63550b966cab137686966341f8","0xc117b7b797846764209eea716c91f2ccad3ffeba","0xde122c843be5d4fbe663b37f903a56585c84b2af","0xe0cafc3f52ce85ebd32a429b4ba630cd4d67dee0","0x42a2d778d2d1f4b5058161270be3dd53ba4031ac","0x544a2d74b72415ea241b1d69b458e80366219585","0xbed45bf417b9cb5f50afdd0c780a6b86500daa27","0xe888882b4fc5f1298dddea95800770d05ea478db","0x8865b92255553dec97a320fc6814af681e427d0c","0x318ad3bb44e158713ea55b56b0e0de1f5cbf1a7b","0x41aaa2a090990e420b4a9e8b67fef8228a14ddae","0x6aea2801d292a5f6c41b0433fced948c9d5a7b08","0xd12d1bcdeed98af9b03fbc97c12112d23558d3b1","0xb00bac52fb21443d881ca83459a7cba68518833a","0x17b3c28c5bba00dbf61b2b2a4eae9388c3c28ea2","0x0746613a2d0f079ab3b90c4a11203d4c1b9d01c6","0x859f25949620bd3a67cf62cf52adafcc33f64237","0x737d0d1a6a060ee4a14d5811e8e527589a1a1c28","0x0d3020934f7cbdf560ca6d9c9f42c2e77b6d069d","0x6dc34f188421928409c70a288379ccdb5d7d0cd9","0x79962c8aea9a4a9946b56fd275c8bf4a07025d52","0x6ae707ba9e526215b2c026e91f09d30b7a4d1e26","0x6734dbf3de79f7a812b8a01babdc0a7195bfa5de","0x4303ab9318f93c52ab8112a0133e6340b0c89b93","0x84cba2342458c9581e0213e9904bca1638ef804d","0xaa37c57387ec0b214ac6ff96d01445db202e6e17","0x8891126070fcb991260796c17f4ebcc355cc2513","0xaf0f6bb7aa889ff8d58835fce7272d525e2f5528","0x429ccb7d152ac77fa481c0771dc638f02f0d9ec0","0xb3110e3607af8d175212180a3d6cb4b98de46362","0x3860228d2f3043abef5ebf56de7a5d946a278ab5","0xf4401a4b6e36a27bd71de1142b81ed395a90e307","0x720a2e1ed157cfc1abfe7fea1685e1cd5ef94533","0xcafb4be1e1b2d0f715d97e3436f3c74176365542","0x7d56477d1cc7b2eda30728276568796ac236caeb","0xefdd93614e64c0ba739a98fb33778f9e703db5d5","0xb0f3e3a30fa8dc27d36a32604f7762e6f15f9571","0xc0cf110fbc0d1e5c3b1120ee7b0f55270b97190a","0x943db14cf91563b39196cab6120929afbf3a6f8d","0xcf2c886db678a28f5f8175a8ddba6adc2d888626","0xa9783b18f2294344be9566ce5470803675d5dff8","0x13db5afb244f28fb5dbd6172f12ca764a7bd83d4","0xe7039b5fa7f5726a9bbed9fdc01c0a3be1d7f666","0x3afaa31605097f783ce499704d92f1c7e1035d49","0x483e97f024bb06c629606dc72339486554654c46","0x737b7ffff00d122026115f987eec10e741fd8ad8","0xa5409432e4b26d8f58ba1cb646cd1734b5566d59","0x506c426d0b33b2ea0c045cf0603d79855eba6e67","0x496af62a45771185f49123fb5ba5fe03fefc6752","0x8a444d274bf14be608f3366dc3ef7a6de87a1f00","0xd5be2fea95b7e053ba37b87e1a721f1e2604153e","0x9849371b16ae518cfc5faa67f4520a7cd1a07a35","0xcc715da5960299c1e01abe3f7bdb2d773d6b6f3d","0xe9a20fc20221084ee4e174fa37d8502c225bbd5c","0x32a7f6de0a3bdeb818a07c65529d83d126d255fa","0x065242d83a61411b4653c0c745d99ace5db4c1f8","0xa180895035af7711a5fbd8260697d3f25d69a3b4","0xe3d078cc2ec650da7f98a06acbb9d83fa5deac8e","0x831726350d1392a75c607e3649e37aa9c6ecc383","0x8db60b17e0e26fb32c4cf9624634f8cd5dba4666","0x32457bc031f7a4525e7363527a298dbc9e9da3ca","0xfc63cec5a17a6fd14e64a6b0aa02d14e7c8d0804","0x18aa5bd5d45f7781e6e7bd8ae502368c368ba635","0xfc9099c3620b8a5c87d74445f259f4d6f8896cbb","0xf9cf1188e48d110e43ea25c28f4911d85cbd800d","0xe0f57e056a49df841426018220a818684e18fc4d","0x629d2a850de3b03dbd04ad5cbe615262729dd405","0x1c548e26cf4a94bb28bdf8bac27fd70fd397b971","0x99f1c124d7317aba9fe810304e3e3b31a3f151a5","0x27f543da4d3e3beb056c1349b80360307b4c4eb9","0x3b5cde39270bc1df21d06712dc7971b5b1a3c818","0xde750ca3f0a7cfd2e0026189807b1bd89eade2ee","0xbc2b7748d638bf0cedf9150b4dd480974476b9c2","0x1d31710f9fd3dfa02a3608a80b0b725c5db5cdaa","0xc5ded040caff05d265d3c62e729e7e43deb7c51b","0x194e5e7ee6f30bf58f62413cd6ccaf1e3206adfa","0x14ad95f16bab931a9047f63eeb6548d92ac0b28f","0xe47ff26c58646cedfd2d8ca2b4f31acdca8cba2f","0x7cd7e0f8a13e0caa10b369ece6f72ed7352e6b9f","0xb27e9e9d2c7f44822593883a7ccee905603ed563","0x3d8d41878fb4dd267bfdff05f91b875fafbb4726","0xff37c1c02241ca863bfea03dcb7a7bac44d71ae0","0x63a5e0392633383c22b8d21cfeff986e9d96b7fe","0x28afb3a49d0c614e50da8f94dca5cbcdfbf4af24","0x68ae8fec56b64a9283cc977f7c36f4ba05062a8d","0xd8206391622db2409e8e7181ca35420d401ae00e","0x2dd67ad399d01d75503b4ceb8a59e1996a94e837","0x11ae0d896d99a0a57a5601430df91b42e64dbcb4","0xb524b21ba7ecd75b98ecba7520ecaedf90e0a3d0","0x6d85bd65a99d257c0b064c4d6a85bc40554316eb","0x5bd3334a22cee93ec55eeac15ce042a79f705712","0x72fb9d71b5b5aab645c5f93a8fed6b59e03b0d11","0x1e8505ddd8e1f869b8db0dc94042d3f7e5896b1a","0x1a9439d1803569ef3a4223ef79996717b187513f","0x87502de996cd8f30a2e0280021f282099973db8f","0x00a81500496f19195726ff65766fe09b092369d7","0x5e6010ec0e9ffa568cd242f904302fbb4cf00d8c","0xafcf7b957cd000d1993c2d1843a1651a6b63f4c5","0xf189fa5cbca4ac89189bd649fb71b23931b0c41f","0xcba39131306c459b9a984b6f9680006aa057188d","0x1ef52b5be76b06508508c83a42714e63af158525","0xbc4e13679281b4b6bad6da57bc3105c22689b709","0x1d17e0e01c8d8ecb830d8c79c328de2d3c228783","0x5f4b86443f12b8fc8a7e5376baf23ef91e53138b","0xf9b2ae5810dbd836220b8ca3b87b38ba53f77eac","0xb787229ef74e4dc7d898bd94ebf913f40bba2419","0x9835103a4e87325b85d9229a46763f2d71f0bc50","0xbb6f32a4fda01ebece3aa65d7937047543b1d596","0x52052ff16b1eb0bb14d0331d143d85a53807e3bf","0x84763950cd25bd2e05989a34fcb9385a7f4b4deb","0x3f90dac7a8dbc1794289535c59ee150399786e26","0x46d485f0eba0de1be79d2bf205922514a607ebb2","0x9f39e876174bad03df817805417321bbc4573c7c","0x782878d2330205297dbae1ff82552212bb34e555","0x7482d3d868d5804c1d74971c41580c00507a30cd","0x3a0c34363814ad43aeb7a0060fa9905190d8c74d","0xd56902125cde6577cbbdf016d70de602d407e353","0x92d56fd23f2210d50746d331cfbaa05c68a3f1af","0x43c1e3183f82ff8c6c3eacfe23cac2fb00cd7ba0","0xdbaa3f80036b5d90dbcf00ec18e1c241658f4bd9","0x9b4d753b507af8153cdf95257892f9aca655ac08","0x0bd0ec9be7f12e21c576daaa578f71099a141b07","0x9cbe5e2148ec011ab20ccea0e7674e52ecf4b715","0x3b1caf5b1af68d328561fab85a0ad141a9beb5af","0x291641c782b3511edf3c5f886a13b2893ece0805","0x601b912d9002cf7653cc9b16d1f89904ac1add7f","0xa248d0d57c25a62467de685c100b13b172821150","0x7ca876b2d3891f6bb5fad8ff4b5f23af3411da4c","0x9a1e2055f1e0e11f9271ae092ab9555ccbc6a8b6","0x30a964c5e8663333f4726e7e14237a2a0fd4e5c0","0x3c75a4afed001629a51f13ab457f59d9c9841d3f","0x0c01830ff588a797019f70235d16d33ab59d159f","0x59e5bf3f068b92a73b48d00b58df7f93e7cfe1dc","0x0e441cb841115b72e0a52aa4aafe19abad6cdd26","0x1a828c97f522b19c71dcc5da387a19f02d456e49","0xfc94ddf9917014c8618af7026d0c87f53796b5f3","0x596df2d1751ef1fc8f1f455bd6a68bfe1b631625","0x1ff0499f0ce8760029ed5e3f68234d5e9d88818c","0x08d851cc66606a942f0293975bf901e9dfc66995","0x0284d0cd8f0f0639721fe7c7e97f6c228d321054","0xb1338dc6151e5733d18baa349cd2867cc86e453f","0xea09634481a44c46b6ec789246da0d64a4ed66d7","0xc78a2a1e6de9c4348a3fe057bdcf8fe7b259a70d","0x54918d709dbedb484774256257c4bcff265bb160","0x78a80d5fac73e94fdbaf18472fdbd50d430b1c6d","0xa3245f25ff3e4b2a2150ff82edfeda81466e7d5a","0x324b5f5a9decf6705568793606b0edcb2a6807e7","0x7f223d098db174ca81f07f5f924fe079c3fd1204","0x9829a8c8feac87296d07dedac6db46d411d9c981","0xf74d88282de03544a66d18757ef0552cab36a313","0x916bb0c26e2c8caec61e7122af70eecb59ddf57a","0x3ac96de741ea639fcb3ac851773a182a441467be","0x321b94f92820d6d3ae85c20bd6141e8e3363fd91","0x33e2edcf15efddaf9614ca7f7eed3cebafd167a5","0x51d0e5f7aefa20f17424f1b50185213133135909","0x8fcceec02d03e767588d976cd3c7836ddf298aef","0xcf409d659dd4f0eef5c5717d676258e74052f5ca","0x57a03d85371265e61975982cbddb36bcf4ba4389","0xcfb77ef6f7486e2b6e3c92f6b832ad57ac70e4b1","0x6e1f93d6043315e3d111380498e2493a02dcc4bc","0xfaa1df6728cd69a69ac3a4e6954e8fe190fb32b2","0x8faf3c43cd661d52ce7abccbb63825558e337e52","0xfa6e48f4f67ec262472b6fa9f06acac284fd0b1c","0x995967d676eca583374b413ef7964f0cc3133420","0xf35cb8d2eb170c7372cfe20459ad30bae6b28f96","0xfbc98bf1567ada91a7780b5a91291024bb72a562","0x9d04c57556134eb7d6a88065e4c0010b6fe56927","0x4212e9e2e66c616352c579cd2093b2fac2382b75","0x5ee41ef2f5cc2762c7904f5718aae8d6f6bae8ba","0x83ef9e793dddedfa57ced5118ff88a9ebfd5a36c","0x2a3e8c001eec32198e61dc82cb0eea4434a943d1","0xea78d5e43dd70a906196483b215ac51fe35364fd","0x5c82632fc61836fca6a283e26ad4d8854d8c03c5","0xe01840501b2c450b5a3e4352a5ea9197e02af04a","0xe86ae16911c393cbaf62d3e370fdf209f139504b","0x1fbc5635da114967cddde2ec07045d8d1366be3d","0xaf63dfd75bb648c5fa09799c5db1b99a05bd7a83","0x292784b65aa50d5154f3479b9bcd2fe9487251f9","0xb44f7ec449e6fbd66cc5d27307d0c6a67fcc5b2f","0x1222f36966a63c472aced82238c0010bb917658d","0xb84987da396f33ead6e7cdf011f08dade1612e94","0x3622bc6fcab2f2df4da0cc4eed5881b79afa7c57","0xe449b03539e17908ff668c325e664b08774c003f","0x8107a36785b0d798c1c094e2b1864abad1f69818","0x56f8312765a6a5c6b1b2d0fdc71da22762a9c9b4","0x016ee18044ab142966fcf6fdd5510b30b4b19cc9","0x302aedb2f3556120221a2caed508a97ae43c9e89","0x471b1f862b2da312c34777e65cc950e890f7ef44","0xb7dcbdfb448887ed323b804dad47f50a3a020197","0xb83ec0a4d51096e2433ad2bea58a1e742c85867e","0x826189eb87f5cf35c6bc84fd7f0cfbda5f6ce4a0","0xeba45d49f4c9fd8b506875441669a801cccfb3bf","0xccc65721ded607b53b2c43926196dfe7e888a9c0","0x9bb12a678793a8fa318d1bd90026c2f90a775168","0x6d2afcd66eb849ead9ad276972b71f77dd06cb62","0x6004e5b6975ae4250c464405f7cc5b982391fafe","0x8922e1a0f9fbc4c640e4132b1240af80a63cc1a5","0xe22ff8e66506f0062a52bb39cc1dae2e3764def1","0x0d515e0b66153a00b4a4ffd5865e7230f658e3b6","0x8864c16f6a0375fb0a45533037a33122fe0f98f3","0x87df8579574afb7de2f93d48683c140b0e0f7af3","0xdfc183f9528bbdeac1de2bf2d9d12c97d4684066","0x1723c8ad12fa7f966fc602135a9d3a4669719427","0x60a89ff92566785a03b96a199095d2d5a2c02bcf","0xce3d8a033e5525d845e67c17e4965b97c09b65ed","0x194f665654eb8a2d9703b76f37d2fb85a93b2d16","0x9c762ba061336c18cd2b57d2c7312c77f2b76bc5","0x4d5e980d390b942638d21822beb8fd71caff6596","0xb68ec6496bdeafec469f2ac9475502fb72f2387f","0x4d092abc1708aa60639b47035cb927e3e73a4091","0x87e1fe20b9adc11af9027e83c3b8bc48ca061295","0xf7ca438d8d4ce0040001e4e2bc3e7c523fccc8f1","0x46c7fd037cbafc8d54a0d4e5719b5bf8b2719b04","0x2ad63cd83533556b12749dfcfaa3eea0137a42cb","0xc199d9cfb19aa10a642521408a74cfe7fc66b313","0xd8f62af735ea72f45d4dd48867575a87e11262aa","0xf5bdf0e7fe794f3f18322c465a295fbf00fcd1ae","0x279dca7e6428712aee5447d9907953b93ab64761","0xbd8721111ef862f64a11f0feb44fa46b31bd3f1d","0x7da020d25dc2919bcd10d278bbfbf98251af14f5","0x1924066f5527208c625ca418919dc2337c17da12","0x1a6964b91f2cb327d8918737cd2b082b0dced321","0x3f3836dd935ba6de549e59ecfed6f5d12908485f","0xca943792b33b3eab25ee8173653164c9fc7f5645","0x775ab1f799d4d82e5596af6f8914c2e4d1e7b5b9","0x8e929e60110b003a18c8cca8efea39d81ad4ade4","0x3e432156d89a25b0954c1cb4416e88bb4246a544","0x8a93caf59c18822b0b7b8c03effce65c7983e7f2","0x8ae2dcc275525f33d3d666557f6a7e7301092fa0","0x601c91098a37b69637e123c0c0eba279cc415bcf","0x387fcd4eb7d3b6468d04a3818a87cae0da39761b","0x1b32565361544908267b1a893189bd5b811ede3d","0xfc3703a07d4cc97e6d231fec973cbddb26fe8ab1","0x4393f7cacb5fec37874bead50ac351b083d8cc5e","0x6e335616cd300757d28d8c2147d39b095a799206","0x7d35518172c517fe74599bad1a988e39f750f0c4","0xfeed3258b4e7f6ca70a4cf8bf889fc8184f9d1c6","0x377818a1bf84a067a9e2e96dce43180b24750e20","0x18590398ce22753729363f1d5cc9447285a27941","0x5cc45bd7fc078a0b88b2adfd758fc4250c8a852d","0x040ce27ab8b7c7b59bb95537c086a6b50dfd2786","0x04c35f7f1e1df485026094b03f080112621e5a5c","0x9e274e4cb8cb0924df9e1c70857ee280c874532f","0xde2e353d1d23e1cbcd0f0760e051ff4cfdfd183f","0x82507513fb96e0eb59dca3d86abb3fd3eaf3996c","0xf5d22f747b2faa94973b999833850bd1b8278fc0","0x7a5fc970a3466b3fbba5260942808660b4890d46","0xcf7d7e56c830b7c03bd491154bd6880aaea61cde","0x5a2f3a1183612d1be9dde6fab44087bac2c435df","0xa9ad8d1711466903575e81d3cc3bf7a102e9e7d8","0xbbdd315df88de18d6ac6d04e75829f828c27285d","0xb5cff04492a04aa0c9379e02ff1d84d4b548ddbb","0xc77511b5d066775bcaaeafe40762152fb7fb5ca1","0xd9ca56f5c9e2cdd3f2adb0039f828050d873bf6e","0xa700cf8824e1fad2fb8e89b6b49df5f8039df799","0x2266d38cfe3caf2ebd5d2c293d86babca6bf72de","0x87a2e37619bd3a22b9c0e9f5a88432418acee0ec","0xab493f9246579d78514617b242c58f236824761c","0xea829a09a2fab55eeff5b16bd648007f595aa92e"]

def moralis_auth(request):
    if (request.user.is_authenticated):
        try:
            redirect_to = request.GET["next"]
            if (redirect_to):
                return redirect(redirect_to)
            raise Exception
        except:
            return redirect('dashboard')
    else:
        return render(request, 'page/login.html', {})

def moralis_logout(request):
    try:
        logout(request)
    except:
        pass
    return redirect('login')

@csrf_exempt
def RequestMessage(request):
    data = json.loads(request.body)

    ArkAPI = MoralisAPI.objects.filter(active=True)[0]
    MoralisLogin = MoralisAuth.objects.filter(name="ArkLogin", active=True)[0]

    today = time.time()
    after  = datetime.fromtimestamp(today+float(MoralisLogin.EXPIRATION_TIME)).strftime("%Y-%m-%dT00:00:00.000Z")
    before = datetime.fromtimestamp(today-float(MoralisLogin.EXPIRATION_TIME)).strftime("%Y-%m-%dT00:00:00.000Z")

    REQUEST_URL = 'https://authapi.moralis.io/challenge/request/evm'
    request_object = {
      "domain": MoralisLogin.DOMAIN,
      "chainId": int(MoralisLogin.CHAIN_ID),
      "address": data['address'],
      "statement": MoralisLogin.STATEMENT,
      "uri": MoralisLogin.URI,
      "expirationTime": after,
      "notBefore": before,
      "timeout": int(MoralisLogin.TIMEOUT)
    }

    response = requests.post(
        REQUEST_URL,
        json=request_object,
        headers={'X-API-KEY': ArkAPI.API_KEY})

    return JsonResponse(response.json())

@csrf_exempt
def VerifyMessage(request):
    data = json.loads(request.body)

    ArkAPI = MoralisAPI.objects.filter(active=True)[0]

    REQUEST_URL = 'https://authapi.moralis.io/challenge/verify/evm'
    x = requests.post(
        REQUEST_URL,
        json=data,
        headers={'X-API-KEY': ArkAPI.API_KEY})
    print(json.loads(x.text))
    print(x.status_code)
    if x.status_code == 201:
        # user can authenticate
        eth_address=json.loads(x.text).get('address')
        print("eth address", eth_address)
        try:
            user = User.objects.get(username=eth_address)
        except User.DoesNotExist:
            if (True):
            #if (eth_address.lower() in AllowedAddress):
                user = User(username=eth_address)
                user.is_staff = False
                user.is_superuser = False
                user.save()
                player = Player(user=user,address=eth_address,nickname=eth_address)
                player.save()
        if user is not None:
            if user.is_active:
                login(request, user)
                request.session['auth_info'] = data
                request.session['verified_data'] = json.loads(x.text)
                return JsonResponse({'user': user.username})
            else:
                return JsonResponse({'error': 'account disabled'})
    else:
        return JsonResponse(json.loads(x.text))